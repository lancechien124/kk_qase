# ðŸš€ MeterSphere Python Backend - å®Œæ•´é‹è¡ŒæŒ‡å—

## æ–¹å¼ä¸€ï¼šä½¿ç”¨ Docker Composeï¼ˆæœ€ç°¡å–®ï¼ŒæŽ¨è–¦ï¼‰

### å¿«é€Ÿå•Ÿå‹•ï¼ˆä¸€éµå®Œæˆï¼‰

```bash
cd metersphere/backend_python
./start.sh
```

### æ‰‹å‹•æ­¥é©Ÿ

#### 1. é€²å…¥é …ç›®ç›®éŒ„

```bash
cd metersphere/backend_python
```

#### 2. å‰µå»ºç’°å¢ƒè®Šé‡æ–‡ä»¶

```bash
# å‰µå»º .env æ–‡ä»¶
cat > .env << 'EOF'
# Application
DEBUG=True
LOG_LEVEL=INFO

# Database
DATABASE_URL=mysql+pymysql://root:password@mysql:3306/metersphere?charset=utf8mb4
MYSQL_ROOT_PASSWORD=password

# Redis
REDIS_URL=redis://redis:6379/0
REDIS_PASSWORD=

# Kafka
KAFKA_BOOTSTRAP_SERVERS=kafka:9092

# MinIO
MINIO_ENDPOINT=minio:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin

# Security (ç”Ÿç”¢ç’°å¢ƒå¿…é ˆä¿®æ”¹)
SECRET_KEY=change-this-secret-key-in-production
JWT_SECRET_KEY=change-this-jwt-secret-key-in-production
EOF
```

#### 3. å•Ÿå‹•æ‰€æœ‰æœå‹™

```bash
# æ§‹å»ºä¸¦å•Ÿå‹•ï¼ˆé¦–æ¬¡å•Ÿå‹•éœ€è¦æ§‹å»ºé¡åƒï¼Œç´„ 5-10 åˆ†é˜ï¼‰
docker-compose up -d --build

# æŸ¥çœ‹æœå‹™ç‹€æ…‹
docker-compose ps
```

#### 4. ç­‰å¾…æœå‹™å•Ÿå‹•ï¼ˆç´„ 30-60 ç§’ï¼‰

```bash
# ç­‰å¾… MySQL å®Œå…¨å•Ÿå‹•
sleep 30

# æª¢æŸ¥æœå‹™ç‹€æ…‹
docker-compose ps
```

#### 5. åˆå§‹åŒ–æ•¸æ“šåº«

```bash
# é‹è¡Œæ•¸æ“šåº«é·ç§»
docker-compose exec backend python -m alembic upgrade head
```

#### 6. é©—è­‰å®‰è£

```bash
# æª¢æŸ¥å¥åº·ç‹€æ…‹
curl http://localhost:8081/api/v1/health

# æˆ–ç€è¦½å™¨è¨ªå•
# http://localhost:8081/api/v1/health
```

---

## æ–¹å¼äºŒï¼šæœ¬åœ° Python ç’°å¢ƒé‹è¡Œ

### 1. ç³»çµ±è¦æ±‚

- Python 3.11+
- MySQL 8.0+
- Redis 6.0+
- Kafka (å¯é¸)
- MinIO (å¯é¸)

### 2. å®‰è£ä¾è³´

```bash
cd backend_python

# å‰µå»ºè™›æ“¬ç’°å¢ƒ
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate  # Windows

# å®‰è£ä¾è³´
pip install -r ../requirements.txt
```

### 3. é…ç½®ç’°å¢ƒè®Šé‡

```bash
# å‰µå»º .env æ–‡ä»¶
cp .env.example .env
# ç·¨è¼¯ .env æ–‡ä»¶ï¼Œè¨­ç½®æ•¸æ“šåº«å’Œ Redis é€£æŽ¥
```

### 4. åˆå§‹åŒ–æ•¸æ“šåº«

```bash
# ç¢ºä¿ MySQL æ­£åœ¨é‹è¡Œ
# å‰µå»ºæ•¸æ“šåº«
mysql -u root -p -e "CREATE DATABASE metersphere CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# é‹è¡Œé·ç§»
alembic upgrade head
```

### 5. å•Ÿå‹•æœå‹™

```bash
# ä½¿ç”¨å•Ÿå‹•è…³æœ¬
./run.sh

# æˆ–ç›´æŽ¥é‹è¡Œ
python main.py
```

---

## ðŸ“‹ å®Œæ•´å‘½ä»¤åƒè€ƒ

### Docker Compose å‘½ä»¤

```bash
# å•Ÿå‹•æœå‹™
docker-compose up -d

# åœæ­¢æœå‹™
docker-compose down

# æŸ¥çœ‹æ—¥èªŒ
docker-compose logs -f backend

# é‡å•Ÿæœå‹™
docker-compose restart

# é€²å…¥å®¹å™¨
docker-compose exec backend bash

# åŸ·è¡Œå‘½ä»¤
docker-compose exec backend python -m alembic upgrade head
```

### æ•¸æ“šåº«æ“ä½œ

```bash
# é‹è¡Œé·ç§»
docker-compose exec backend alembic upgrade head

# å‰µå»ºæ–°é·ç§»
docker-compose exec backend alembic revision --autogenerate -m "description"

# é€²å…¥æ•¸æ“šåº«
docker-compose exec mysql mysql -u root -ppassword metersphere
```

---

## ðŸŒ è¨ªå•åœ°å€

å•Ÿå‹•æˆåŠŸå¾Œï¼š

- **API å¥åº·æª¢æŸ¥**: http://localhost:8081/api/v1/health
- **Swagger æ–‡æª”**: http://localhost:8081/api/docs
- **ReDoc æ–‡æª”**: http://localhost:8081/api/redoc
- **æŒ‡æ¨™ç«¯é»ž**: http://localhost:8081/api/v1/metrics

---

## ðŸ› å¸¸è¦‹å•é¡Œ

### 1. æ§‹å»ºå¤±æ•—

```bash
# æ¸…ç†æ§‹å»ºç·©å­˜
docker-compose build --no-cache

# é‡æ–°æ§‹å»º
docker-compose up -d --build
```

### 2. ç«¯å£è¢«å ç”¨

ä¿®æ”¹ `docker-compose.yml` ä¸­çš„ç«¯å£æ˜ å°„ï¼š

```yaml
ports:
  - "8082:8081"  # æ”¹ç‚ºå…¶ä»–ç«¯å£
```

### 3. æ•¸æ“šåº«é€£æŽ¥å¤±æ•—

```bash
# æª¢æŸ¥ MySQL å®¹å™¨
docker-compose logs mysql

# ç­‰å¾… MySQL å®Œå…¨å•Ÿå‹•
sleep 30
docker-compose exec backend python -m alembic upgrade head
```

### 4. æœå‹™ç„¡æ³•å•Ÿå‹•

```bash
# æŸ¥çœ‹è©³ç´°æ—¥èªŒ
docker-compose logs backend

# æª¢æŸ¥å®¹å™¨ç‹€æ…‹
docker-compose ps -a
```

---

## âœ… é©—è­‰é‹è¡Œ

```bash
# é‹è¡Œé©—è­‰è…³æœ¬
docker-compose exec backend python scripts/verify.py

# æ‡‰è©²çœ‹åˆ°
# âœ“ All modules verified successfully!
```

---

## ðŸŽ‰ å®Œæˆï¼

ç¾åœ¨æ‚¨å¯ä»¥ï¼š

1. âœ… è¨ªå• API æ–‡æª”
2. âœ… ä½¿ç”¨æ‰€æœ‰ API ç«¯é»ž
3. âœ… é–‹å§‹é–‹ç™¼å’Œæ¸¬è©¦

è©³ç´°æ–‡æª”è«‹æŸ¥çœ‹ï¼š
- [å¿«é€Ÿå•Ÿå‹•æŒ‡å—](å¿«é€Ÿå•Ÿå‹•.md)
- [Docker é‹è¡ŒæŒ‡å—](README_DOCKER.md)
- [éƒ¨ç½²æŒ‡å—](docs/DEPLOYMENT.md)

